# Reference Data Sources and Acquisition Plan

Phase 1 (P1.1) — data acquisition documentation.
Run `data/download.sh` after completing the registration steps below.

---

## 1. Data Products Required

### 1.1 MERIT-DEM (elevation source)
- **Version**: MERIT-DEM v1.0.3 (2019)
- **Resolution**: 3 arc-seconds (~90m at equator)
- **Format**: GeoTIFF, 5°×5° tiles, WGS84 / EGM96
- **Registration**: Required. Free academic use.
  - URL: <https://hydro.iis.u-tokyo.ac.jp/~yamadai/MERIT_DEM/>
  - Complete the "Data Request Form" and save credentials to environment variables:
    ```bash
    export MERIT_USER="your_email@example.com"
    export MERIT_PASS="your_password"
    ```
- **Citation**: Yamazaki D. et al. (2017) A high-accuracy map of global terrain elevations.
  Geophysical Research Letters 44(11):5844-5853. DOI: 10.1002/2017GL072874
- **Tile naming**: SW-corner convention. `n25e080` = 25-30°N, 80-85°E. `s05e020` = 5-10°S, 20-25°E.
  `n35w110` = 35-40°N, 105-110°W (W-longitude tiles extend east from named corner).

### 1.2 Geomorpho90m — Geomorphon 10-class raster
- **Variable**: `geom` (10-class geomorphon landform classification)
- **Resolution**: 3 arc-seconds (~90m), co-registered with MERIT-DEM
- **Format**: Cloud-Optimised GeoTIFF (COG), 15°×15° tiles
- **Access**: OpenTopography portal — no registration required for download.
  - Dataset DOI: 10.5069/G91R6NPX
  - Portal: <https://portal.opentopography.org/dataspace/dataset?opentopoID=OTDS.012020.4326.1>
  - Direct tile access (verify current URL at portal before use):
    ```
    https://opentopography.s3.sdsc.edu/dataspace/OTDS.012020.4326.1/raster/geom/
    ```
  - Tile naming: 15°×15° tiles named by SW corner, e.g. `geomorpho90m_geom_merit_dem_egm96_wgs84_S15E015_c_20181019.tif`
- **Citation**: Amatulli G. et al. (2020) Geomorpho90m, empirical evaluation and accuracy assessment
  of global morpho-terrain derivatives. Scientific Data 7:162. DOI: 10.1038/s41597-020-0479-6

### 1.3 Köppen-Geiger Climate Classification
- **Version**: Beck et al. (2018) 1km resolution global map
- **Resolution**: 30 arc-seconds (~1km) — resample to 90m for co-registration
- **Format**: GeoTIFF, single global file (or regional tiles)
- **Access**: No registration required.
  - Figshare: <https://figshare.com/articles/dataset/Present_and_future_Köppen-Geiger_climate_classification_maps_at_1-km_resolution/6396959>
  - Direct download: `present.zip` (~350MB) from the Figshare page above.
- **Citation**: Beck H.E. et al. (2018) Present and future Köppen-Geiger climate classification maps at
  1-km resolution. Scientific Data 5:180214. DOI: 10.1038/sdata.2018.214
- **Usage**: Intersect with Geomorpho90m geomorphon raster in P1.3 (classifier tool) to assign
  definitive TerrainClass labels. Köppen zone + dominant geomorphon class → TerrainClass.

---

## 2. Sampling Regions

Five regions, one per TerrainClass. See `data/regions.json` for machine-readable definitions
(bounding boxes, tile IDs, filter rules).

| ID | TerrainClass | Tectonic Context | Location | MERIT Tiles | Est. Usable Tiles |
|---|---|---|---|---|---|
| `himalaya` | Alpine | ActiveCompressional | Central Himalayas 25-35°N 78-92°E | n25e080 n25e085 n30e080 n30e085 | ~150 |
| `congo` | FluvialHumid | CratonicShield | Congo Basin margins 8°S-2°N 15-28°E | s00e015 s00e020 s05e015 s05e020 s05e025 | ~120 |
| `ahaggar` | Cratonic | CratonicShield | Ahaggar Massif 20-27°N 4-12°E | n20e005 n20e010 n25e005 | ~80 |
| `colorado_plateau` | FluvialArid | PassiveExtensional | Colorado Plateau 35-38°N 107-113°W | n35w115 n35w110 | ~80 |
| `atlantic_coastal` | Coastal | PassiveMargin | US Atlantic coastal plain 34-38°N 75-82°W | n35w080 n30w080 n35w085 | ~150 |

All regions yield ≥50 usable tiles after classification filtering. See `data/regions.json` for
per-region filter rules applied during P1.3.

---

## 3. Download Sequence

Run these steps in order. Each step deposits files in `data/raw/`:

```
data/
  raw/
    merit/          # MERIT-DEM GeoTIFF tiles (one per 5°×5° region)
    geomorpho90m/   # Geomorphon 10-class COG tiles
    koppen/         # Köppen-Geiger classification raster
  samples/          # Generated by tools/sampler (Phase 1.2) — not committed
  targets/          # Generated by tools/distributions (Phase 1.4) — committed
```

**Step 1: Register for MERIT-DEM** (one-time, takes ~24h for approval)
  → <https://hydro.iis.u-tokyo.ac.jp/~yamadai/MERIT_DEM/>

**Step 2: Download Köppen-Geiger** (no registration, ~350MB)
  ```bash
  ./data/download.sh koppen
  ```

**Step 3: Download Geomorpho90m geomorphon tiles** (~2GB for 5 regions)
  ```bash
  ./data/download.sh geomorpho90m
  ```

**Step 4: Download MERIT-DEM tiles** (requires credentials from Step 1, ~4GB)
  ```bash
  MERIT_USER=your@email.com MERIT_PASS=yourpassword ./data/download.sh merit
  ```

**Step 5: Verify checksums**
  ```bash
  ./data/download.sh verify
  ```

---

## 4. TerrainClass Assignment Logic

Used in P1.3 (classifier tool). Priority order:

1. If `GlacialClass = Active` → **excluded from main 5 classes** (sampled separately if needed)
2. If Köppen ∈ {ET, EF} AND elevation > 3000m → **Alpine**
3. If Geomorpho90m dominant class ∈ {peak, ridge, shoulder, spur} AND elevation > 1500m → **Alpine**
4. If Köppen ∈ {Af, Am, Aw} AND geomorphon ∈ {valley, hollow, slope, footslope} → **FluvialHumid**
5. If Köppen ∈ {BWh, BWk, BSh, BSk} AND geomorphon shows channel evidence → **FluvialArid**
6. If geomorphon ∈ {flat, slope} AND roughness < 50m AND distance_from_ocean < 200km → **Coastal**
7. If geomorphon ∈ {flat, slope} AND roughness < 100m AND tectonic_context = CratonicShield → **Cratonic**
8. Ambiguous tiles → **discard** (do not force-classify)

The classifier tool (P1.3) implements this logic using the MERIT-DEM tile + Geomorpho90m geomorphon
raster + Köppen raster intersection. One tile may contain pixels of multiple classes; the tile as a
whole is classified by the dominant class (>70% pixel agreement).

---

## 5. Geomorpho90m Variables Needed

Only `geom` (10-class landform) is needed for Phase 1. Additional variables from Geomorpho90m can
be used for Phase 2 validation (P2.4–P2.8 cross-checks) but are not downloaded in Phase 1.

| Variable | Geomorpho90m Name | Phase Needed | Why |
|---|---|---|---|
| Geomorphon 10-class | `geom` | P1.3 | Terrain class labeling |
| Slope | `slope` | P2.4 (optional) | Validation cross-check |
| Aspect | `aspect` | P2.5 (optional) | Validation cross-check |
| Roughness | `roughness` | P2.2 (optional) | Validation cross-check |
| TPI | `tpi` | P2.6 (optional) | Validation cross-check |

Optional Phase 2 validation variables can be downloaded later using the same `download.sh` script
with the `--variables` flag.

---

## 6. Checksum File

SHA-256 checksums are stored in `data/checksums.txt` (generated after download by `download.sh verify`).
File format: `sha256sum` standard output (`<hash>  <filename>`).

Pre-download template committed to track expected filenames. Hashes populated after download.

---

## 7. Literature Validation Tolerances

Used in P1.5 (validate_targets tool). Computed distributions must fall within:

| Metric | Class | Literature Target | Source |
|---|---|---|---|
| Hurst Exponent | Alpine | 0.75-0.90 | SRTM analysis, Gagnon et al. 2006 |
| Hurst Exponent | FluvialHumid | 0.70-0.85 | Gagnon et al. 2006 |
| Bifurcation Ratio | FluvialHumid | 3.0-5.0 | Horton (1945), Schumm (1956) |
| Bifurcation Ratio | FluvialArid | 3.0-5.5 | Abrahams (1984) |
| Geomorphon valley+hollow % | Alpine | 15-35% | Jasiewicz & Stepinski (2013) |
| Geomorphon flat+slope % | Cratonic | 55-80% | Geomorpho90m reference stats |
| Hypsometric Integral | Alpine | 0.45-0.65 | Strahler (1952) |
| Hypsometric Integral | FluvialHumid | 0.35-0.55 | Strahler (1952) |
| Hypsometric Integral | Coastal | 0.30-0.45 | Strahler (1952) |

Document version 1.1 | Updated for Phase 1 acquisition planning
